# AWS

IMDSv2
```
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"` && curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/iam/security-credentials/
```
![image](https://github.com/user-attachments/assets/17f3b35d-66cf-46a6-90f2-d956b5071396)

# ECS
Если контейнер уже запущен, вы можете проверить, какие метаданные доступны, посмотрев на значения переменных окружения внутри контейнера:
```
echo $ECS_CONTAINER_METADATA_URI
echo $ECS_CONTAINER_METADATA_URI_V3
echo $ECS_CONTAINER_METADATA_URI_V4
```
В зависимости от того, какая из переменных присутствует и содержит значение, вы узнаете, какая версия метаданных активирована.

ECS Metadata
```
curl 169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI
```
2. Получение учетных данных через "/creds"
Этот метод возвращает временные учетные данные с ограниченными правами. Чтобы получить их, нужно выполнить HTTP-запрос внутри контейнера:
```
curl http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI/creds
```
Этот запрос вернет JSON с временными учетными данными, такими как AccessKeyId, SecretAccessKey, и SessionToken.
3. Получение учетных данных для роли через "/role/{role name}"
Этот метод позволяет получить учетные данные для указанной роли IAM. Чтобы сделать это, используйте:

```
curl http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI/role/<role_name>
```
Где <role_name> — имя роли, которую вы хотите использовать. Ответ будет содержать учетные данные для этой роли.

4. Получение учетных данных для роли через "/role-arn/{role arn}"
Этот вариант используется, если вы хотите получить учетные данные для роли, которая может находиться в другой учетной записи AWS:
```
curl http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI/role-arn/<role_arn>
```
Где <role_arn> — это полный ARN роли (например, arn:aws:iam::123456789012:role/YourRoleName).

Эти запросы выполняются через стандартный curl запрос внутри контейнера. Важно убедиться, что переменная окружения AWS_CONTAINER_CREDENTIALS_RELATIVE_URI установлена и доступна, иначе запрос не будет работать.

Если у вас включены метаданные V3 или V4, то вместо http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI можно использовать http://169.254.170.2/v3 или http://169.254.170.2/v3/containers/{container_name} соответственно, чтобы получить дополнительные данные.
